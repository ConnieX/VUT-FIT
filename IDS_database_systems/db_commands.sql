CREATE PROCEDURE delete_tables AS
BEGIN
    declare cursor c1 is select table_name from user_tables;
    cmd varchar2(200);
    BEGIN
        for c in c1 loop
            cmd := 'drop table '||c.table_name||' cascade constraints';
            execute immediate cmd;
        end loop;
        EXCEPTION WHEN OTHERS THEN DBMS_OUTPUT.PUT_LINE ('Table could not be deleted.');
    END;
END;

begin
	DELETE_TABLES;
end;

CREATE TABLE Druh (
  id NUMBER(10) NOT NULL,
  nazev VARCHAR2(45) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE Pecivo (
  id NUMBER(10) NOT NULL,
  nazev VARCHAR2(45) NULL,
  bezlepkove NUMBER(10) NULL,
  hmotnost NUMBER(10) NULL,
  cena FLOAT(10) NULL,
  Druh_id NUMBER(10) NOT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_druh_id
    FOREIGN KEY (Druh_id)
    REFERENCES Druh (id)
   )
;

CREATE TABLE Suroviny (
  id NUMBER(10) NOT NULL,
  nazev VARCHAR2(45) NULL,
  mnozstvi_skladem NUMBER(10) NULL,
  nakupni_cena FLOAT(10) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE pecivo_je_z_surovin (
  Suroviny_id NUMBER(10) NULL,
  Pecivo_id NUMBER(10) NOT NULL,
  mnozstvi NUMBER(10) NULL,
  PRIMARY KEY (Suroviny_id, Pecivo_id),
  CONSTRAINT fk_suroviny_id
    FOREIGN KEY (Suroviny_id)
    REFERENCES Suroviny (id)
   ,
  CONSTRAINT fk_pecivo_id
    FOREIGN KEY (Pecivo_id)
    REFERENCES Pecivo (id)
   )
;

CREATE TABLE Alergeny (
  nazev VARCHAR2(45) NOT NULL,
  PRIMARY KEY (nazev))
;

CREATE TABLE Surovina_ma_alergeny (
  Suroviny_id NUMBER(10) NULL,
  Alergeny_nazev VARCHAR2(45) NULL,
  PRIMARY KEY (Suroviny_id, Alergeny_nazev),
  CONSTRAINT fk_alerg_suroviny_id
    FOREIGN KEY (Suroviny_id)
    REFERENCES Suroviny (id)
   ,
  CONSTRAINT fk_alergeny_nazev
    FOREIGN KEY (Alergeny_nazev)
    REFERENCES Alergeny (nazev)
   )
;

CREATE TABLE Predmet (
  id NUMBER(10) NOT NULL,
  nazev VARCHAR2(45) NULL,
  skladem_kusu NUMBER(10) NULL,
  cena FLOAT(10) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE stav_objednavky (
  id NUMBER(10) NOT NULL,
  stav VARCHAR2(45) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE Veznice (
  id NUMBER(10) NOT NULL,
  nazev VARCHAR2(45) NULL,
  mesto VARCHAR2(100) NULL,
  ulice VARCHAR2(45) NULL,
  cislo_popisne NUMBER(10) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE Cela (
  cislo NUMBER(10) NOT NULL,
  typ VARCHAR2(45) NULL,
  Veznice_id NUMBER(10) NOT NULL,
  PRIMARY KEY (Veznice_id, cislo),
  CONSTRAINT fk_cela_veznice_id
    FOREIGN KEY (Veznice_id)
    REFERENCES Veznice (id)
   )
;

CREATE TABLE Vezen (
  id NUMBER(10) NOT NULL,
  jmeno VARCHAR2(45) NULL,
  prijmeni VARCHAR2(45) NULL,
  Cela_Veznice_id NUMBER(10) NOT NULL,
  Cela_cislo NUMBER(10) NOT NULL,
  PRIMARY KEY (id),
  CONSTRAINT fk_Vezen_Cela1
    FOREIGN KEY (Cela_Veznice_id , Cela_cislo)
    REFERENCES Cela (Veznice_id , cislo)
   )
;

CREATE TABLE Paserak (
  id NUMBER(10) NOT NULL,
  jmeno VARCHAR2(45) NULL,
  prijmeni VARCHAR2(45) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE Objednavka (
  termin_dodani DATE NULL,
  celkova_cena FLOAT(10) NULL,
  zpusob_dodani VARCHAR2(45) NULL,
  stav_objednavky_id NUMBER(10) NOT NULL,
  Vezen_id NUMBER(10) NOT NULL,
  Paserak_id NUMBER(10) NOT NULL,
  id NUMBER(10) NOT NULL,
  PRIMARY KEY (Vezen_id, id),
  CONSTRAINT fk_stav_objednavky_id
    FOREIGN KEY (stav_objednavky_id)
    REFERENCES stav_objednavky (id)
   ,
  CONSTRAINT fk_vezen_id
    FOREIGN KEY (Vezen_id)
    REFERENCES Vezen (id)
   ,
  CONSTRAINT fk_paserak_id
    FOREIGN KEY (Paserak_id)
    REFERENCES Paserak (id)
   )
;

CREATE TABLE Polozka_objednavky (
  pocet_kusu NUMBER(10) NULL,
  celkova_cena FLOAT(10) NULL,
  Predmet_id NUMBER(10) NULL,
  Pecivo_id NUMBER(10) NOT NULL,
  id NUMBER(10) NOT NULL,
  Objednavka_Vezen_id NUMBER(10) NOT NULL,
  Objednavka_id NUMBER(10) NOT NULL,
  PRIMARY KEY (id, Objednavka_Vezen_id, Objednavka_id),
  CONSTRAINT fk_premdet_id
    FOREIGN KEY (Predmet_id)
    REFERENCES Predmet (id)
   ,
  CONSTRAINT fk_poloz_pecivo_id
    FOREIGN KEY (Pecivo_id)
    REFERENCES Pecivo (id)
   ,
  CONSTRAINT fk_objednavka_id
    FOREIGN KEY (Objednavka_Vezen_id , Objednavka_id)
    REFERENCES Objednavka (Vezen_id , id)
   )
;

CREATE TABLE Pekar (
  id NUMBER(10) NOT NULL,
  jmeno VARCHAR2(45) NULL,
  prijmeni VARCHAR2(45) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE Dozorce (
  id NUMBER(10) NOT NULL,
  jmeno VARCHAR2(45) NULL,
  prijmeni VARCHAR2(45) NULL,
  PRIMARY KEY (id))
;

CREATE TABLE je_domluven (
  paserak_id NUMBER(10) NOT NULL,
  dozorce_id NUMBER(10) NULL,
  PRIMARY KEY (paserak_id, dozorce_id),
  CONSTRAINT fk_domluv_paserak_id
    FOREIGN KEY (paserak_id)
    REFERENCES Paserak (id)
   ,
  CONSTRAINT fk_domluv_dozorce_id
    FOREIGN KEY (dozorce_id)
    REFERENCES Dozorce (id)
   )
;

CREATE TABLE Smena (
  cas_nastupu TIMESTAMP(0) NULL,
  cas_ukonceni TIMESTAMP(0) NULL,
  Veznice_id NUMBER(10) NOT NULL,
  id NUMBER(10) NOT NULL,
  PRIMARY KEY (Veznice_id, id),
  CONSTRAINT fk_smena_veznice_id
    FOREIGN KEY (Veznice_id)
    REFERENCES Veznice (id)
   )
;

CREATE TABLE pracuje_v (
  Dozorce_id NUMBER(10) NULL,
  Veznice_id NUMBER(10) NOT NULL,
  PRIMARY KEY (Dozorce_id, Veznice_id),
  CONSTRAINT fk_pracuje_dozorce_id
    FOREIGN KEY (Dozorce_id)
    REFERENCES Dozorce (id)
   ,
  CONSTRAINT fk_pracuje_veznice_id
    FOREIGN KEY (Veznice_id)
    REFERENCES Veznice (id)
   )
;

CREATE TABLE pekar_pece (
  Objednavka_Vezen_id NUMBER(10) NOT NULL,
  Objednavka_id NUMBER(10) NOT NULL,
  Pekar_id NUMBER(10) NOT NULL,
  PRIMARY KEY (Objednavka_Vezen_id, Objednavka_id, Pekar_id),
  CONSTRAINT fk_pece_objednavka_id
    FOREIGN KEY (Objednavka_Vezen_id , Objednavka_id)
    REFERENCES Objednavka (Vezen_id , id)
   ,
  CONSTRAINT fk_pece_pekar_id
    FOREIGN KEY (Pekar_id)
    REFERENCES Pekar (id)
   )
;

CREATE TABLE je_na_smene (
  Smena_Veznice_id NUMBER(10) NOT NULL,
  Smena_id NUMBER(10) NOT NULL,
  Dozorce_id NUMBER(10) NOT NULL,
  PRIMARY KEY (Smena_Veznice_id, Smena_id, Dozorce_id),
  CONSTRAINT fk_je_na_veznice_id
    FOREIGN KEY (Smena_Veznice_id , Smena_id)
    REFERENCES Smena (Veznice_id , id)
   ,
  CONSTRAINT fk_je_na_dozorce_id
    FOREIGN KEY (Dozorce_id)
    REFERENCES Dozorce (id)
   )
;



INSERT INTO ALERGENY (NAZEV) VALUES ('arašídy');
INSERT INTO ALERGENY (NAZEV) VALUES ('celer');
INSERT INTO ALERGENY (NAZEV) VALUES ('hořčice');
INSERT INTO ALERGENY (NAZEV) VALUES ('korýši');
INSERT INTO ALERGENY (NAZEV) VALUES ('lepek ');
INSERT INTO ALERGENY (NAZEV) VALUES ('mléko');
INSERT INTO ALERGENY (NAZEV) VALUES ('mořské plody');
INSERT INTO ALERGENY (NAZEV) VALUES ('oxid siřičitý a siřičitany');
INSERT INTO ALERGENY (NAZEV) VALUES ('ryby');
INSERT INTO ALERGENY (NAZEV) VALUES ('sezam');
INSERT INTO ALERGENY (NAZEV) VALUES ('skořápkové plody');
INSERT INTO ALERGENY (NAZEV) VALUES ('vejce');
INSERT INTO ALERGENY (NAZEV) VALUES ('vlčí bob');

INSERT INTO DRUH (ID, NAZEV) VALUES (1, 'celozrnné');
INSERT INTO DRUH (ID, NAZEV) VALUES (2, 'cereální');
INSERT INTO DRUH (ID, NAZEV) VALUES (3, 'sladké');
INSERT INTO DRUH (ID, NAZEV) VALUES (4, 'slané');
INSERT INTO DRUH (ID, NAZEV) VALUES (5, 'světlé');
INSERT INTO DRUH (ID, NAZEV) VALUES (6, 'pšeničné');
INSERT INTO DRUH (ID, NAZEV) VALUES (7, 'kukuřičné');
INSERT INTO DRUH (ID, NAZEV) VALUES (8, 'kváskové');

INSERT INTO DOZORCE (ID, JMENO, PRIJMENI) VALUES (456, 'Tomáš', 'Jedno');
INSERT INTO DOZORCE (ID, JMENO, PRIJMENI) VALUES (987, 'Vítězslav ', 'Chlupatý');
INSERT INTO DOZORCE (ID, JMENO, PRIJMENI) VALUES (654, 'Lukáš', 'Vítámvás');
INSERT INTO DOZORCE (ID, JMENO, PRIJMENI) VALUES (658, 'Pavel', 'Petrklíč');
INSERT INTO DOZORCE (ID, JMENO, PRIJMENI) VALUES (231, 'Zdeněk', 'Nemístný');

INSERT INTO PASERAK (ID, JMENO, PRIJMENI) VALUES (165153, 'Kryštof', 'Skočdopole');
INSERT INTO PASERAK (ID, JMENO, PRIJMENI) VALUES (98745, 'Matěj', 'Neznámý');
INSERT INTO PASERAK (ID, JMENO, PRIJMENI) VALUES (6874352, 'Karel', 'Tichý');

INSERT INTO STAV_OBJEDNAVKY (ID, STAV) VALUES (1, 'přijata');
INSERT INTO STAV_OBJEDNAVKY (ID, STAV) VALUES (2, 'peče se ');
INSERT INTO STAV_OBJEDNAVKY (ID, STAV) VALUES (3, 'čeká na vyzvednutí');
INSERT INTO STAV_OBJEDNAVKY (ID, STAV) VALUES (4, 'na cestě');
INSERT INTO STAV_OBJEDNAVKY (ID, STAV) VALUES (5, 'doručena');

INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (1, 'rohlík', 0, 50, 2, 5);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (2, 'rohlík celozrnný', 0, 50, 3, 1);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (3, 'rohlík cereální', 0, 50, 2, 2);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (4, 'rohlík se slaninou', 0, 70, 10, 4);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (5, 'bageta', 0, 100, 15, 5);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (6, 'bageta celozrnná', 0, 100, 20, 1);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (7, 'bageta cereální', 0, 100, 15, 2);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (8, 'veka', 0, 100, 30, 5);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (9, 'vánočka', 0, 250, 40, 3);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (10, 'houska', 0, 50, 3, 5);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (11, 'houska řemeslná', 0, 50, 5, 1);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (12, 'chléb chasnický', 0, 250, 30, 6);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (13, 'chléb vlašácký', 0, 250, 35, 8);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (14, 'chléb kukuřičný', 1, 180, 40, 7);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (15, 'croissant máslový', 0, 50, 15, 3);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (16, 'croissant čokoládový', 0, 50, 15, 3);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (17, 'croissant mandlový', 0, 50, 15, 3);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (18, 'kobliha s meruňkovou marmeládou', 0, 50, 15, 3);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (19, 'kobliha s jahodovou marmeládou', 0, 50, 15, 3);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (20, 'štrůdl jablečný ', 0, 80, 20, 3);
INSERT INTO PECIVO (ID, NAZEV, BEZLEPKOVE, HMOTNOST, CENA, DRUH_ID) VALUES (21, 'závin tvarohový', 0, 80, 20, 3);

INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (111, 'mouka pšeičná', 10000, 5);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (112, 'mouka celozrnná', 15000, 10);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (113, 'mouka kukuřičná', 8000, 15);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (114, 'mouka žitná', 10000, 5);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (115, 'mouka špaldová', 8567, 7);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (116, 'kvásek', 5000, 8);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (117, 'droždí', 3500, 8);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (118, 'cukr moučka', 9756, 5);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (119, 'cukr krystal', 2000, 5);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (120, 'cukr krupice', 999, 5);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (121, 'vajíčka', 500, 20);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (122, 'mléko', 500, 15);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (123, 'smetana', 500, 30);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (124, 'sůl', 15000, 5);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (125, 'směs koření', 4000, 25);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (126, 'máslo', 20000, 40);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (127, 'med', 1000, 50);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (128, 'voda', 30000, 2);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (129, 'směs semínek', 1000, 50);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (130, 'směs ořechů', 1000, 120);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (131, 'slanina', 500, 40);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (132, 'sýr', 600, 30);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (133, 'sezamové semínka', 1000, 25);
INSERT INTO SUROVINY (ID, NAZEV, MNOZSTVI_SKLADEM, NAKUPNI_CENA) VALUES (134, 'slunečnicové semínka', 1000, 40);

INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (654, 'pilník', 20, 150);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (987, 'šroubovák křížový', 65, 80);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (657, 'šroubovák plochý', 69, 80);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (258, 'pila', 40, 200);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (354, 'kladivo', 60, 250);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (687, 'nůž', 120, 60);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (741, 'páčidlo', 36, 22);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (165, 'malý krumpáč', 15, 87);
INSERT INTO PREDMET (ID, NAZEV, SKLADEM_KUSU, CENA) VALUES (925, 'majzlík', 36, 32);

INSERT INTO JE_DOMLUVEN (PASERAK_ID, DOZORCE_ID) VALUES (98745, 658);
INSERT INTO JE_DOMLUVEN (PASERAK_ID, DOZORCE_ID) VALUES (98745, 987);
INSERT INTO JE_DOMLUVEN (PASERAK_ID, DOZORCE_ID) VALUES (165153, 456);
INSERT INTO JE_DOMLUVEN (PASERAK_ID, DOZORCE_ID) VALUES (165153, 654);
INSERT INTO JE_DOMLUVEN (PASERAK_ID, DOZORCE_ID) VALUES (6874352, 231);

INSERT INTO VEZNICE (ID, NAZEV, MESTO, ULICE, CISLO_POPISNE) VALUES (987, 'Ostravská věznice ', 'Ostrava', 'Nerovná', 654);
INSERT INTO VEZNICE (ID, NAZEV, MESTO, ULICE, CISLO_POPISNE) VALUES (654, 'Brněnská věznice', 'Brno', 'Kataláškova', 5);
INSERT INTO VEZNICE (ID, NAZEV, MESTO, ULICE, CISLO_POPISNE) VALUES (321, 'Olomoucká věznice ', 'Olomouc', 'Sýrová', 10);

INSERT INTO CELA (CISLO, TYP, VEZNICE_ID) VALUES (123, 'samotka', 987);
INSERT INTO CELA (CISLO, TYP, VEZNICE_ID) VALUES (152, 'dvojlůžko', 987);
INSERT INTO CELA (CISLO, TYP, VEZNICE_ID) VALUES (123, 'trojlůžko', 654);
INSERT INTO CELA (CISLO, TYP, VEZNICE_ID) VALUES (654, 'čtyřlůžko', 321);

INSERT INTO VEZEN (ID, JMENO, PRIJMENI, CELA_VEZNICE_ID, CELA_CISLO) VALUES (23546, 'Jáchym', 'Brzobohatý', 987, 123);
INSERT INTO VEZEN (ID, JMENO, PRIJMENI, CELA_VEZNICE_ID, CELA_CISLO) VALUES (98764, 'Vladimír', 'Kazimír', 987, 152);
INSERT INTO VEZEN (ID, JMENO, PRIJMENI, CELA_VEZNICE_ID, CELA_CISLO) VALUES (564895, 'Libor', 'Rádsetoulal', 987, 152);
INSERT INTO VEZEN (ID, JMENO, PRIJMENI, CELA_VEZNICE_ID, CELA_CISLO) VALUES (98465, 'Jana', 'Straširybková', 654, 123);
INSERT INTO VEZEN (ID, JMENO, PRIJMENI, CELA_VEZNICE_ID, CELA_CISLO) VALUES (54158, 'David', 'Zabilpivo', 321, 654);

INSERT INTO SMENA (CAS_NASTUPU, CAS_UKONCENI, VEZNICE_ID, ID) VALUES (TO_TIMESTAMP('2020-04-24 14:00:00', 'YYYY-MM-DD HH24:MI:SS'), TO_TIMESTAMP('2020-04-24 22:00:00', 'YYYY-MM-DD HH24:MI:SS'), 987, 1);
INSERT INTO SMENA (CAS_NASTUPU, CAS_UKONCENI, VEZNICE_ID, ID) VALUES (TO_TIMESTAMP('2020-03-26 13:51:53', 'YYYY-MM-DD HH24:MI:SS'), TO_TIMESTAMP('2020-03-26 23:51:58', 'YYYY-MM-DD HH24:MI:SS'), 654, 2);
INSERT INTO SMENA (CAS_NASTUPU, CAS_UKONCENI, VEZNICE_ID, ID) VALUES (TO_TIMESTAMP('2020-06-26 13:52:15', 'YYYY-MM-DD HH24:MI:SS'), TO_TIMESTAMP('2020-03-26 19:52:21', 'YYYY-MM-DD HH24:MI:SS'), 321, 3);

INSERT INTO JE_NA_SMENE (SMENA_VEZNICE_ID, SMENA_ID, DOZORCE_ID) VALUES (987, 1, 456);
INSERT INTO JE_NA_SMENE (SMENA_VEZNICE_ID, SMENA_ID, DOZORCE_ID) VALUES (987, 1, 658);

INSERT INTO OBJEDNAVKA (TERMIN_DODANI, CELKOVA_CENA, ZPUSOB_DODANI, STAV_OBJEDNAVKY_ID, VEZEN_ID, PASERAK_ID, ID) VALUES (TO_DATE('2020-05-11 09:50:33', 'YYYY-MM-DD HH24:MI:SS'), 12, 'osobně', 1, 98465, 165153, 5);
INSERT INTO OBJEDNAVKA (TERMIN_DODANI, CELKOVA_CENA, ZPUSOB_DODANI, STAV_OBJEDNAVKY_ID, VEZEN_ID, PASERAK_ID, ID) VALUES (TO_DATE('2020-05-11 09:31:18', 'YYYY-MM-DD HH24:MI:SS'), 5, 'rychle', 1, 564895, 6874352, 2);
INSERT INTO OBJEDNAVKA (TERMIN_DODANI, CELKOVA_CENA, ZPUSOB_DODANI, STAV_OBJEDNAVKY_ID, VEZEN_ID, PASERAK_ID, ID) VALUES (TO_DATE('2020-03-26 14:44:37', 'YYYY-MM-DD HH24:MI:SS'), 127, 'osobně', 2, 23546, 165153, 236589);

INSERT INTO PEKAR (ID, JMENO, PRIJMENI) VALUES (10, 'Václav', 'Pekař');
INSERT INTO PEKAR (ID, JMENO, PRIJMENI) VALUES (20, 'Veronika', 'Pšeničná');
INSERT INTO PEKAR (ID, JMENO, PRIJMENI) VALUES (30, 'Petr', 'Ječmen');

INSERT INTO PEKAR_PECE (OBJEDNAVKA_VEZEN_ID, OBJEDNAVKA_ID, PEKAR_ID) VALUES (23546, 236589, 10);

INSERT INTO PECIVO_JE_Z_SUROVIN (SUROVINY_ID, PECIVO_ID, MNOZSTVI) VALUES (112, 2, 5);
INSERT INTO PECIVO_JE_Z_SUROVIN (SUROVINY_ID, PECIVO_ID, MNOZSTVI) VALUES (111, 1, 20);
INSERT INTO PECIVO_JE_Z_SUROVIN (SUROVINY_ID, PECIVO_ID, MNOZSTVI) VALUES (112, 1, 5);
INSERT INTO PECIVO_JE_Z_SUROVIN (SUROVINY_ID, PECIVO_ID, MNOZSTVI) VALUES (126, 1, 10);
INSERT INTO PECIVO_JE_Z_SUROVIN (SUROVINY_ID, PECIVO_ID, MNOZSTVI) VALUES (128, 1, 10);

INSERT INTO POLOZKA_OBJEDNAVKY (POCET_KUSU, CELKOVA_CENA, PREDMET_ID, PECIVO_ID, ID, OBJEDNAVKA_VEZEN_ID, OBJEDNAVKA_ID) VALUES (1, 127, 165, 9, 564, 23546, 236589);

INSERT INTO PRACUJE_V (DOZORCE_ID, VEZNICE_ID) VALUES (456, 987);
INSERT INTO PRACUJE_V (DOZORCE_ID, VEZNICE_ID) VALUES (658, 987);


INSERT INTO SUROVINA_MA_ALERGENY (SUROVINY_ID, ALERGENY_NAZEV) VALUES (111, 'lepek ');
INSERT INTO SUROVINA_MA_ALERGENY (SUROVINY_ID, ALERGENY_NAZEV) VALUES (112, 'lepek ');
INSERT INTO SUROVINA_MA_ALERGENY (SUROVINY_ID, ALERGENY_NAZEV) VALUES (114, 'lepek ');
INSERT INTO SUROVINA_MA_ALERGENY (SUROVINY_ID, ALERGENY_NAZEV) VALUES (130, 'skořápkové plody');

-- Vybere z databáze počet objednávek, podle věznice
SELECT COUNT(OBJEDNAVKA.ID) AS "Počet objednávek", V.MESTO
FROM OBJEDNAVKA
    JOIN VEZEN ON OBJEDNAVKA.VEZEN_ID = VEZEN.ID
    JOIN VEZNICE V on VEZEN.CELA_VEZNICE_ID = V.ID
GROUP BY V.MESTO, V.NAZEV;

-- Vyfiltruje bezlepkové pečiva, které jsou složené z určitého typu mouky
SELECT PECIVO.NAZEV, PECIVO.HMOTNOST, PECIVO.CENA
FROM PECIVO
WHERE BEZLEPKOVE = 0 AND
    EXISTS(SELECT PECIVO_JE_Z_SUROVIN.PECIVO_ID FROM PECIVO_JE_Z_SUROVIN WHERE PECIVO_ID = PECIVO.ID AND SUROVINY_ID = 111);

-- Seskupí typy pečiva dle jejich počtu
SELECT  COUNT(DRUH_ID) as "Počet", D.NAZEV
FROM PECIVO
    JOIN DRUH D on PECIVO.DRUH_ID = D.ID
GROUP BY PECIVO.DRUH_ID, D.NAZEV;

-- Vybere seznam věznů, kteří jsou ve veznici, umístěné v určitém městě dle prvního znaku názvu
SELECT VEZEN.JMENO, VEZEN.PRIJMENI, VEZEN.CELA_CISLO,VEZEN.CELA_VEZNICE_ID
FROM VEZEN
WHERE VEZEN.CELA_VEZNICE_ID IN (SELECT VEZNICE.ID FROM VEZNICE WHERE SUBSTR(VEZNICE.MESTO, 1, 1) = 'O');



CREATE SEQUENCE VEZEN_SEQ START WITH 1 INCREMENT BY 1;

CREATE OR REPLACE TRIGGER Vezen_trigger
 BEFORE INSERT ON VEZEN FOR EACH ROW
 WHEN (NEW.id IS NULL)
BEGIN
 SELECT VEZEN_SEQ.NEXTVAL INTO :new.id FROM DUAL;
END;

CREATE OR REPLACE TRIGGER Smena_trigger
    BEFORE INSERT ON SMENA FOR EACH ROW
    WHEN (NEW.CAS_UKONCENI IS NULL)
BEGIN
    SELECT :new.CAS_NASTUPU + interval '8' hour INTO :new.CAS_UKONCENI FROM DUAL;
end;



CREATE PROCEDURE give_rights AS
BEGIN
   declare
    cursor c1 is select table_name from user_tables;
    cursor c2 is select sequence_name from user_sequences;
    cursor c3 is select MVIEW_NAME from all_mviews;
    cursor c4 is select * from ALL_OBJECTS where OBJECT_TYPE = 'PROCEDURE' and OWNER = 'XOPLAT01';
    cmd varchar2(200);
    BEGIN
        for c in c1 loop
            cmd := 'GRANT ALL ON '||c.table_name||' TO xrosin00';
            execute immediate cmd;
        end loop;
        for c in c2 loop
            cmd := 'GRANT ALL ON '||c.SEQUENCE_NAME||' TO xrosin00';
            execute immediate cmd;
        end loop;
         for c in c3 loop
            cmd := 'GRANT ALL ON '||c.MVIEW_NAME||' TO xrosin00';
            execute immediate cmd;
        end loop;
         for c in c4 loop
            cmd := 'GRANT EXECUTE ON '||c.OBJECT_NAME||' TO xrosin00';
            execute immediate cmd;
        end loop;
    END;
END;

CREATE INDEX idx_objednavka_stav ON OBJEDNAVKA (stav_objednavky_id ASC) VISIBLE;
CREATE INDEX idx_objednavka_paserak ON OBJEDNAVKA (Paserak_id ASC) VISIBLE;


EXPLAIN PLAN FOR
SELECT  COUNT(DRUH_ID), D.NAZEV
FROM PECIVO
    JOIN DRUH D on PECIVO.DRUH_ID = D.ID
GROUP BY PECIVO.DRUH_ID, D.NAZEV;

SELECT PLAN_TABLE_OUTPUT FROM TABLE(DBMS_XPLAN.DISPLAY());

CREATE MATERIALIZED VIEW MVobjednavka
    refresh on commit
    AS SELECT * FROM OBJEDNAVKA;